unit ufPrincipal;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.Buttons, Vcl.ExtCtrls,
  _threadDigest, Vcl.ComCtrls;

type
  TFPrincipal = class(TForm)
    Label1: TLabel;
    edArquivo: TEdit;
    Label2: TLabel;
    edMD5: TEdit;
    btAbrir: TBitBtn;
    btComparar: TBitBtn;
    btFechar: TBitBtn;
    fOpen: TFileOpenDialog;
    Label3: TLabel;
    edResultado: TEdit;
    pbStatus: TProgressBar;
    procedure btFecharClick(Sender: TObject);
    procedure btAbrirClick(Sender: TObject);
    procedure btCompararClick(Sender: TObject);
  private
    f_threadDigest: TThreadDigest;
    procedure Done(var md5: string; const error_code: Integer);
  end;

var
  FPrincipal: TFPrincipal;

implementation

uses
  md5,
  IdHashMessageDigest;

{$R *.dfm}

procedure TFPrincipal.btAbrirClick(Sender: TObject);
var
  v_file: string;
begin
  if fOpen.Execute then v_file := fOpen.FileName;
  edArquivo.Text := v_file;

  f_threadDigest := TThreadDigest.Create;
  try
    f_threadDigest.OnDone := Done;
    f_threadDigest.FileName := v_file;
    //f_threadDigest.WaitFor;

  finally
    //FreeAndNil(f_threadDigest);
  end;
end;

procedure TFPrincipal.btCompararClick(Sender: TObject);
begin
  edResultado.Text := MD5DigestToStr(MD5String(''));
end;

procedure TFPrincipal.btFecharClick(Sender: TObject);
begin
  Self.Close;
end;

procedure TFPrincipal.Done(var md5: string; const error_code: Integer);
begin
  edResultado.Text := f_threadDigest.MD5String;
  f_threadDigest.Terminate;
end;

end.
